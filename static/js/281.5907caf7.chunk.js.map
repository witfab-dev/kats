{"version":3,"file":"static/js/281.5907caf7.chunk.js","mappings":"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","sources":["utils/analytics.js"],"sourcesContent":["/**\r\n * Analytics utility for tracking user behavior and page views\r\n */\r\n\r\nimport { schoolInfo } from '../assets/data/constants';\r\n\r\n// Configuration\r\nconst analyticsConfig = {\r\n  // Google Analytics 4\r\n  ga4MeasurementId: process.env.REACT_APP_GA4_MEASUREMENT_ID || 'G-XXXXXXXXXX',\r\n  \r\n  // Google Analytics (Universal Analytics - Optional)\r\n  uaTrackingId: process.env.REACT_APP_UA_TRACKING_ID || 'UA-XXXXXXXXX-X',\r\n  \r\n  // Facebook Pixel\r\n  facebookPixelId: process.env.REACT_APP_FACEBOOK_PIXEL_ID || '',\r\n  \r\n  // Custom Analytics API\r\n  customAnalyticsEndpoint: process.env.REACT_APP_ANALYTICS_API_URL || '',\r\n  customApiKey: process.env.REACT_APP_ANALYTICS_API_KEY || '',\r\n  \r\n  // Development mode\r\n  debug: process.env.NODE_ENV === 'development',\r\n  \r\n  // Sampling rate (0 to 1, 1 = track all)\r\n  samplingRate: 1.0\r\n};\r\n\r\n// Check if we should track (respects sampling rate and user preferences)\r\nconst shouldTrack = () => {\r\n  // Respect \"Do Not Track\" browser setting\r\n  if (navigator.doNotTrack === '1') {\r\n    return false;\r\n  }\r\n  \r\n  // Check local storage for user preference\r\n  const userOptOut = localStorage.getItem('analytics_opt_out');\r\n  if (userOptOut === 'true') {\r\n    return false;\r\n  }\r\n  \r\n  // Apply sampling rate\r\n  if (analyticsConfig.samplingRate < 1.0) {\r\n    return Math.random() < analyticsConfig.samplingRate;\r\n  }\r\n  \r\n  return true;\r\n};\r\n\r\n// Initialize analytics\r\nexport const initializeAnalytics = () => {\r\n  if (typeof window === 'undefined') return; // Skip during SSR\r\n  \r\n  console.log('ðŸ“Š Initializing analytics...');\r\n  \r\n  // Initialize Google Analytics 4\r\n  if (analyticsConfig.ga4MeasurementId) {\r\n    initializeGA4();\r\n  }\r\n  \r\n  // Initialize Facebook Pixel\r\n  if (analyticsConfig.facebookPixelId) {\r\n    initializeFacebookPixel();\r\n  }\r\n  \r\n  // Initialize custom analytics\r\n  if (analyticsConfig.customAnalyticsEndpoint) {\r\n    initializeCustomAnalytics();\r\n  }\r\n  \r\n  console.log('ðŸ“Š Analytics initialized');\r\n};\r\n\r\n// Google Analytics 4 Initialization\r\nconst initializeGA4 = () => {\r\n  if (!window.dataLayer) {\r\n    window.dataLayer = window.dataLayer || [];\r\n    window.gtag = function() {\r\n      window.dataLayer.push(arguments);\r\n    };\r\n    window.gtag('js', new Date());\r\n    window.gtag('config', analyticsConfig.ga4MeasurementId, {\r\n      page_title: document.title,\r\n      page_location: window.location.href,\r\n      page_path: window.location.pathname,\r\n      send_page_view: false // We'll send page views manually\r\n    });\r\n    \r\n    if (analyticsConfig.debug) {\r\n      console.log('ðŸ“Š GA4 initialized');\r\n    }\r\n  }\r\n};\r\n\r\n// Facebook Pixel Initialization\r\nconst initializeFacebookPixel = () => {\r\n  if (!window.fbq) {\r\n    window.fbq = function() {\r\n      window.fbq.callMethod ? \r\n        window.fbq.callMethod.apply(window.fbq, arguments) : \r\n        window.fbq.queue.push(arguments);\r\n    };\r\n    if (!window._fbq) window._fbq = window.fbq;\r\n    window.fbq.push = window.fbq;\r\n    window.fbq.loaded = true;\r\n    window.fbq.version = '2.0';\r\n    window.fbq.queue = [];\r\n    \r\n    // Initialize Pixel\r\n    window.fbq('init', analyticsConfig.facebookPixelId);\r\n    window.fbq('track', 'PageView');\r\n    \r\n    if (analyticsConfig.debug) {\r\n      console.log('ðŸ“Š Facebook Pixel initialized');\r\n    }\r\n  }\r\n};\r\n\r\n// Custom Analytics Initialization\r\nconst initializeCustomAnalytics = () => {\r\n  if (analyticsConfig.debug) {\r\n    console.log('ðŸ“Š Custom analytics enabled');\r\n  }\r\n};\r\n\r\n// Main page tracking function\r\nexport const trackPageView = async (pagePath, additionalParams = {}) => {\r\n  if (typeof window === 'undefined') return; // Skip during SSR\r\n  \r\n  if (!shouldTrack()) {\r\n    if (analyticsConfig.debug) {\r\n      console.log('ðŸ“Š Tracking skipped (user preference or sampling)');\r\n    }\r\n    return;\r\n  }\r\n  \r\n  const pageTitle = document.title || 'KATSS Website';\r\n  const pageUrl = window.location.href;\r\n  \r\n  // Default parameters\r\n  const defaultParams = {\r\n    page_title: pageTitle,\r\n    page_location: pageUrl,\r\n    page_path: pagePath || window.location.pathname,\r\n    referrer: document.referrer || '',\r\n    user_agent: navigator.userAgent,\r\n    screen_resolution: `${window.screen.width}x${window.screen.height}`,\r\n    timestamp: new Date().toISOString(),\r\n    school_name: schoolInfo.name,\r\n    environment: process.env.NODE_ENV\r\n  };\r\n  \r\n  const trackingParams = { ...defaultParams, ...additionalParams };\r\n  \r\n  try {\r\n    // Track in Google Analytics 4\r\n    if (window.gtag && analyticsConfig.ga4MeasurementId) {\r\n      window.gtag('event', 'page_view', trackingParams);\r\n    }\r\n    \r\n    // Track in Facebook Pixel\r\n    if (window.fbq) {\r\n      window.fbq('track', 'PageView');\r\n    }\r\n    \r\n    // Track in Universal Analytics (if still using)\r\n    if (window.ga && analyticsConfig.uaTrackingId) {\r\n      window.ga('send', 'pageview', pagePath);\r\n    }\r\n    \r\n    // Send to custom analytics endpoint\r\n    if (analyticsConfig.customAnalyticsEndpoint) {\r\n      await sendToCustomAnalytics('page_view', trackingParams);\r\n    }\r\n    \r\n    // Log in development\r\n    if (analyticsConfig.debug) {\r\n      console.log('ðŸ“Š Page view tracked:', {\r\n        page: pagePath,\r\n        url: pageUrl,\r\n        title: pageTitle,\r\n        params: trackingParams\r\n      });\r\n    }\r\n    \r\n    // Store in local history (optional, for offline tracking)\r\n    storeOfflineEvent('page_view', trackingParams);\r\n    \r\n  } catch (error) {\r\n    console.error('ðŸ“Š Analytics error:', error);\r\n    // Don't throw to prevent breaking the app\r\n  }\r\n};\r\n\r\n// Event tracking\r\nexport const trackEvent = async (eventName, eventParams = {}) => {\r\n  if (typeof window === 'undefined') return;\r\n  \r\n  if (!shouldTrack()) return;\r\n  \r\n  const defaultParams = {\r\n    event_category: 'general',\r\n    event_label: '',\r\n    value: 0,\r\n    non_interaction: false,\r\n    timestamp: new Date().toISOString(),\r\n    user_id: localStorage.getItem('user_id') || 'anonymous',\r\n    session_id: getSessionId()\r\n  };\r\n  \r\n  const fullParams = { ...defaultParams, ...eventParams };\r\n  \r\n  try {\r\n    // Google Analytics 4\r\n    if (window.gtag) {\r\n      window.gtag('event', eventName, fullParams);\r\n    }\r\n    \r\n    // Facebook Pixel\r\n    if (window.fbq && eventName === 'purchase') {\r\n      window.fbq('track', 'Purchase', {\r\n        value: fullParams.value,\r\n        currency: 'RWF'\r\n      });\r\n    }\r\n    \r\n    // Custom analytics\r\n    if (analyticsConfig.customAnalyticsEndpoint) {\r\n      await sendToCustomAnalytics('event', {\r\n        event_name: eventName,\r\n        ...fullParams\r\n      });\r\n    }\r\n    \r\n    if (analyticsConfig.debug) {\r\n      console.log('ðŸ“Š Event tracked:', { eventName, params: fullParams });\r\n    }\r\n    \r\n    // Store for offline\r\n    storeOfflineEvent('custom_event', { event_name: eventName, ...fullParams });\r\n    \r\n  } catch (error) {\r\n    console.error('ðŸ“Š Event tracking error:', error);\r\n  }\r\n};\r\n\r\n// Specific event helpers\r\nexport const trackButtonClick = (buttonName, location = '') => {\r\n  trackEvent('button_click', {\r\n    event_category: 'engagement',\r\n    event_label: buttonName,\r\n    location: location || window.location.pathname,\r\n    button_name: buttonName\r\n  });\r\n};\r\n\r\nexport const trackFormSubmission = (formName, success = true, duration = 0) => {\r\n  trackEvent('form_submission', {\r\n    event_category: 'forms',\r\n    event_label: formName,\r\n    form_name: formName,\r\n    success: success,\r\n    duration_ms: duration,\r\n    value: success ? 1 : 0\r\n  });\r\n};\r\n\r\nexport const trackDownload = (fileName, fileType) => {\r\n  trackEvent('file_download', {\r\n    event_category: 'engagement',\r\n    event_label: fileName,\r\n    file_name: fileName,\r\n    file_type: fileType,\r\n    value: 1\r\n  });\r\n};\r\n\r\nexport const trackOutboundLink = (url, linkText) => {\r\n  trackEvent('outbound_click', {\r\n    event_category: 'engagement',\r\n    event_label: url,\r\n    outbound_link: url,\r\n    link_text: linkText || '',\r\n    value: 1\r\n  });\r\n};\r\n\r\nexport const trackApplicationStart = (program, level) => {\r\n  trackEvent('application_start', {\r\n    event_category: 'admissions',\r\n    event_label: program,\r\n    program: program,\r\n    level: level,\r\n    value: 1\r\n  });\r\n};\r\n\r\nexport const trackApplicationComplete = (applicationId, program, duration) => {\r\n  trackEvent('application_complete', {\r\n    event_category: 'admissions',\r\n    event_label: program,\r\n    application_id: applicationId,\r\n    program: program,\r\n    duration_ms: duration,\r\n    value: 1\r\n  });\r\n};\r\n\r\n// Custom analytics endpoint\r\nconst sendToCustomAnalytics = async (eventType, data) => {\r\n  if (!analyticsConfig.customAnalyticsEndpoint) return;\r\n  \r\n  try {\r\n    const response = await fetch(analyticsConfig.customAnalyticsEndpoint, {\r\n      method: 'POST',\r\n      headers: {\r\n        'Content-Type': 'application/json',\r\n        'Authorization': `Bearer ${analyticsConfig.customApiKey}`,\r\n        'X-API-Key': analyticsConfig.customApiKey\r\n      },\r\n      body: JSON.stringify({\r\n        type: eventType,\r\n        data: data,\r\n        timestamp: new Date().toISOString(),\r\n        source: 'web',\r\n        version: '1.0'\r\n      })\r\n    });\r\n    \r\n    if (!response.ok) {\r\n      throw new Error(`Analytics API error: ${response.status}`);\r\n    }\r\n    \r\n    return await response.json();\r\n    \r\n  } catch (error) {\r\n    console.error('ðŸ“Š Custom analytics error:', error);\r\n    // Store failed events for retry\r\n    storeFailedEvent(eventType, data, error.message);\r\n  }\r\n};\r\n\r\n// Session management\r\nlet sessionId = null;\r\n\r\nconst getSessionId = () => {\r\n  if (!sessionId) {\r\n    sessionId = localStorage.getItem('analytics_session_id');\r\n    if (!sessionId) {\r\n      sessionId = generateSessionId();\r\n      localStorage.setItem('analytics_session_id', sessionId);\r\n      localStorage.setItem('analytics_session_start', new Date().toISOString());\r\n      \r\n      // Track session start\r\n      trackEvent('session_start', {\r\n        event_category: 'session',\r\n        session_id: sessionId\r\n      });\r\n    }\r\n  }\r\n  return sessionId;\r\n};\r\n\r\nconst generateSessionId = () => {\r\n  return 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\r\n};\r\n\r\n// Offline storage for events\r\nconst storeOfflineEvent = (eventType, data) => {\r\n  if (typeof window === 'undefined') return;\r\n  \r\n  try {\r\n    const offlineEvents = JSON.parse(localStorage.getItem('analytics_offline_events') || '[]');\r\n    offlineEvents.push({\r\n      type: eventType,\r\n      data: data,\r\n      stored_at: new Date().toISOString()\r\n    });\r\n    \r\n    // Keep only last 100 events\r\n    if (offlineEvents.length > 100) {\r\n      offlineEvents.splice(0, offlineEvents.length - 100);\r\n    }\r\n    \r\n    localStorage.setItem('analytics_offline_events', JSON.stringify(offlineEvents));\r\n  } catch (error) {\r\n    console.error('ðŸ“Š Failed to store offline event:', error);\r\n  }\r\n};\r\n\r\nconst storeFailedEvent = (eventType, data, error) => {\r\n  if (typeof window === 'undefined') return;\r\n  \r\n  try {\r\n    const failedEvents = JSON.parse(localStorage.getItem('analytics_failed_events') || '[]');\r\n    failedEvents.push({\r\n      type: eventType,\r\n      data: data,\r\n      error: error,\r\n      failed_at: new Date().toISOString()\r\n    });\r\n    \r\n    localStorage.setItem('analytics_failed_events', JSON.stringify(failedEvents));\r\n  } catch (error) {\r\n    // Silently fail\r\n  }\r\n};\r\n\r\n// Retry failed events\r\nexport const retryFailedEvents = async () => {\r\n  if (typeof window === 'undefined') return;\r\n  \r\n  try {\r\n    const failedEvents = JSON.parse(localStorage.getItem('analytics_failed_events') || '[]');\r\n    if (failedEvents.length === 0) return;\r\n    \r\n    const successful = [];\r\n    \r\n    for (const event of failedEvents) {\r\n      try {\r\n        await sendToCustomAnalytics(event.type, event.data);\r\n        successful.push(event);\r\n      } catch (error) {\r\n        // Keep failed events for next retry\r\n      }\r\n    }\r\n    \r\n    // Remove successfully sent events\r\n    const remaining = failedEvents.filter(e => !successful.includes(e));\r\n    localStorage.setItem('analytics_failed_events', JSON.stringify(remaining));\r\n    \r\n    if (analyticsConfig.debug) {\r\n      console.log(`ðŸ“Š Retried ${successful.length} events, ${remaining.length} remain`);\r\n    }\r\n    \r\n  } catch (error) {\r\n    console.error('ðŸ“Š Failed to retry events:', error);\r\n  }\r\n};\r\n\r\n// User opt-in/opt-out\r\nexport const setAnalyticsOptOut = (optOut) => {\r\n  if (typeof window === 'undefined') return;\r\n  \r\n  localStorage.setItem('analytics_opt_out', optOut.toString());\r\n  \r\n  if (optOut) {\r\n    // Clear session data\r\n    localStorage.removeItem('analytics_session_id');\r\n    localStorage.removeItem('analytics_session_start');\r\n    \r\n    // Disable GA tracking\r\n    if (window.gtag) {\r\n      window.gtag('config', analyticsConfig.ga4MeasurementId, {\r\n        'allow_ad_personalization_signals': false,\r\n        'allow_google_signals': false\r\n      });\r\n    }\r\n    \r\n    trackEvent('analytics_opt_out');\r\n    \r\n  } else {\r\n    // Re-enable tracking\r\n    initializeAnalytics();\r\n    trackEvent('analytics_opt_in');\r\n  }\r\n  \r\n  if (analyticsConfig.debug) {\r\n    console.log(`ðŸ“Š Analytics ${optOut ? 'disabled' : 'enabled'} by user`);\r\n  }\r\n};\r\n\r\n// Get analytics status\r\nexport const getAnalyticsStatus = () => {\r\n  if (typeof window === 'undefined') {\r\n    return { enabled: false, reason: 'server_side' };\r\n  }\r\n  \r\n  const userOptOut = localStorage.getItem('analytics_opt_out') === 'true';\r\n  const doNotTrack = navigator.doNotTrack === '1';\r\n  \r\n  return {\r\n    enabled: !userOptOut && !doNotTrack,\r\n    user_opt_out: userOptOut,\r\n    do_not_track: doNotTrack,\r\n    session_id: getSessionId(),\r\n    session_start: localStorage.getItem('analytics_session_start'),\r\n    environment: process.env.NODE_ENV\r\n  };\r\n};\r\n\r\n// Initialize on load\r\nif (typeof window !== 'undefined') {\r\n  // Initialize after a short delay to not block page load\r\n  setTimeout(() => {\r\n    initializeAnalytics();\r\n    \r\n    // Retry any failed events from previous sessions\r\n    retryFailedEvents();\r\n    \r\n    // Set up periodic sync\r\n    setInterval(retryFailedEvents, 5 * 60 * 1000); // Every 5 minutes\r\n  }, 1000);\r\n}\r\n\r\n// Export all functions\r\nexport default {\r\n  initializeAnalytics,\r\n  trackPageView,\r\n  trackEvent,\r\n  trackButtonClick,\r\n  trackFormSubmission,\r\n  trackDownload,\r\n  trackOutboundLink,\r\n  trackApplicationStart,\r\n  trackApplicationComplete,\r\n  setAnalyticsOptOut,\r\n  getAnalyticsStatus,\r\n  retryFailedEvents\r\n};"],"names":["analyticsConfig","ga4MeasurementId","process","REACT_APP_GA4_MEASUREMENT_ID","uaTrackingId","REACT_APP_UA_TRACKING_ID","facebookPixelId","REACT_APP_FACEBOOK_PIXEL_ID","customAnalyticsEndpoint","REACT_APP_ANALYTICS_API_URL","customApiKey","REACT_APP_ANALYTICS_API_KEY","debug","samplingRate","shouldTrack","navigator","doNotTrack","localStorage","getItem","Math","random","initializeAnalytics","window","console","log","initializeGA4","initializeFacebookPixel","initializeCustomAnalytics","dataLayer","gtag","push","arguments","Date","page_title","document","title","page_location","location","href","page_path","pathname","send_page_view","fbq","callMethod","apply","queue","_fbq","loaded","version","trackPageView","async","pagePath","additionalParams","length","undefined","pageTitle","pageUrl","defaultParams","referrer","user_agent","userAgent","screen_resolution","concat","screen","width","height","timestamp","toISOString","school_name","schoolInfo","name","environment","trackingParams","_objectSpread","ga","sendToCustomAnalytics","page","url","params","storeOfflineEvent","error","eventType","data","response","fetch","method","headers","body","JSON","stringify","type","source","ok","Error","status","json","storeFailedEvent","message","offlineEvents","parse","stored_at","splice","setItem","failedEvents","failed_at","retryFailedEvents","successful","event","remaining","filter","e","includes","setTimeout","setInterval"],"ignoreList":[],"sourceRoot":""}